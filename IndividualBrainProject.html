<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Individual Brain Project</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1a2e;
            color: #e0e0e0;
        }
        canvas#bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .tab-btn.active {
            border-color: #3b82f6; /* blue-500 */
            color: #ffffff;
            background-color: rgba(59, 130, 246, 0.2);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .wp-card {
            transition: all 0.3s ease-in-out;
        }
        .wp-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .wp-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }
        .wp-details.open {
            max-height: 500px;
            padding: 1.5rem 1.5rem;
        }
        .sim-element {
            transition: all 0.3s ease-in-out;
            filter: grayscale(80%);
            opacity: 0.7;
        }
        .sim-element.active {
            transform: scale(1.05);
            filter: grayscale(0%);
            opacity: 1;
            box-shadow: 0 0 25px var(--glow-color, rgba(59, 130, 246, 0.7));
        }
        .packet {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: #3b82f6;
            border-radius: 50%;
            box-shadow: 0 0 10px #3b82f6, 0 0 20px #3b82f6;
            opacity: 0;
            transition: all 1s ease-in-out;
            z-index: 50;
        }
        .log-entry {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.5s ease-out forwards;
        }
        .challenge-card {
            border-left-width: 4px;
        }
        .connection-line {
            stroke: #3b82f6;
            stroke-width: 3;
            stroke-dasharray: 8 4;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .timeline-box {
            position: relative;
            padding-left: 2.5rem;
            padding-bottom: 2rem;
            border-left: 2px solid #374151;
        }
        .timeline-box:last-child {
            border-left: 2px solid transparent;
            padding-bottom: 0;
        }
        .timeline-icon {
            position: absolute;
            left: -1rem;
            top: 0;
            width: 2rem;
            height: 2rem;
        }
    </style>
</head>
<body class="antialiased">
    <canvas id="bg-canvas"></canvas>

    <header class="bg-[#11223A]/80 backdrop-blur-sm shadow-sm border-b border-gray-700 sticky top-0 z-50">
        <nav class="container mx-auto px-4 md:px-8 py-3 flex items-center justify-between">
              <div class="flex items-center space-x-4">
                  <div class="h-10 w-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xl">IBP</div>
                  <h1 class="text-xl font-bold text-white">The Individual Brain Project</h1>
              </div>
        </nav>
    </header>

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-10 mt-6">
            <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white mb-4">
                A Meta-Scientific Framework for <span class="text-blue-400">Precision Functional Mapping</span>
            </h1>
            <p class="text-lg text-gray-400 max-w-3xl mx-auto">Systematically dismantling the technical barriers of individualized brain parcellation through empirical benchmarking, generative modeling, and scalable software ecosystems.</p>
        </header>

        <div class="bg-[#11223A]/80 backdrop-blur-md rounded-2xl shadow-xl p-4 md:p-8 border border-gray-700">
            
            <div class="border-b border-gray-700 mb-8">
                <nav class="-mb-px flex justify-center space-x-2 md:space-x-8" aria-label="Tabs">
                    <button class="tab-btn active whitespace-nowrap py-4 px-3 border-b-2 font-semibold text-base" data-tab="overview">Project Overview</button>
                    <button class="tab-btn whitespace-nowrap py-4 px-3 border-b-2 font-semibold text-base text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="background">Core Bottlenecks</button>
                    <button class="tab-btn whitespace-nowrap py-4 px-3 border-b-2 font-semibold text-base text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="project">Work Programme</button>
                    <button class="tab-btn whitespace-nowrap py-4 px-3 border-b-2 font-semibold text-base text-gray-400 hover:text-gray-200 hover:border-gray-500" data-tab="simulation">Toolbox Pipeline</button>
                </nav>
            </div>

            <div>
<div id="overview" class="tab-content active">
                     <div class="max-w-4xl mx-auto">
                        <div class="timeline-box">
                            <div class="timeline-icon bg-blue-500 rounded-full flex items-center justify-center text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-blue-300 mb-2">The Methodological Challenge</h3>
                            <p class="text-gray-300 leading-relaxed">Group-level analyses obscure critical individual variations in functional network topology. While Precision Functional Mapping (PFM) addresses this by capturing individualized neural endophenotypes, its application is currently restricted by technical barriers: the degradation of spatial reliability in sparse clinical datasets and a lack of unified standards for aligning structural-functional correspondence across subjects.</p>
                        </div>
                        <div class="timeline-box">
                            <div class="timeline-icon bg-indigo-500 rounded-full flex items-center justify-center text-white">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 01-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 013.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 013.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 01-3.09 3.09z" /></svg>
                            </div>
                            <h3 class="text-2xl font-bold text-indigo-300 mb-2">A Meta-Scientific Solution</h3>
                            <p class="text-gray-300 leading-relaxed mb-6">Addressing these challenges demands more than isolated algorithmic novelty; it requires a domain-informed meta-scientific approach. The Individual Brain Project pursues two synergistic goals:</p>
                             <div class="space-y-6">
                                <div class="flex items-start space-x-4">
                                     <div class="flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-lg p-3">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-blue-200">Phase 1: Empirical Benchmarking & Method Development</h4>
                                        <p class="text-gray-400">Establishing a comprehensive "Knowledge Space" to systematically benchmark PFM failures, providing the physiological constraints required to develop generative diffusion frameworks and unified correspondence algorithms.</p>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-4">
                                     <div class="flex-shrink-0 bg-emerald-500/20 text-emerald-300 rounded-lg p-3">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg text-emerald-200">Phase 2: Clinical Translation & Integration</h4>
                                        <p class="text-gray-400">Integrating novel PFM algorithms into the <em>Individual Brain Toolbox</em>, a standardized software ecosystem designed to deploy personalized functional parcellation across healthy and clinical cohorts.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="background" class="tab-content">
                    <h2 class="text-3xl font-bold text-white mb-8 text-center">Core Methodological Bottlenecks</h2>
                    <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                        <div class="space-y-6">
                            <h3 class="text-xl font-semibold text-center text-rose-300">Methodological Constraints</h3>
                            <div class="challenge-card bg-rose-500/10 p-6 rounded-lg border-rose-500"><div class="flex items-center mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-rose-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg><h4 class="font-bold text-lg text-rose-200">Data Sparsity & The Stability Gap</h4></div><p class="text-gray-400">Clinical MRI datasets routinely fall short of deep-scanning standards, resulting in a quantifiable loss of network topology and test-retest reliability.</p></div>
                            <div class="challenge-card bg-rose-500/10 p-6 rounded-lg border-rose-500"><div class="flex items-center mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-rose-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg><h4 class="font-bold text-lg text-rose-200">Solving Correspondence</h4></div><p class="text-gray-400">Current PFM algorithms exhibit systematic inconsistencies in aligning structural and functional constraints across individuals, compromising predictive validity.</p></div>
                        </div>
                        <div class="space-y-6">
                            <h3 class="text-xl font-semibold text-center text-amber-300">Infrastructural Barriers</h3>
                            <div class="challenge-card bg-amber-500/10 p-6 rounded-lg border-amber-500"><div class="flex items-center mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M5 11h14" /></svg><h4 class="font-bold text-lg text-amber-200">Fragmented Pipelines</h4></div><p class="text-gray-400">Algorithms are developed in silos. The field lacks a dynamic registry to catalogue comparative performance and methodological trade-offs.</p></div>
                            <div class="challenge-card bg-amber-500/10 p-6 rounded-lg border-amber-500"><div class="flex items-center mb-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg><h4 class="font-bold text-lg text-amber-200">Computational Inaccessibility</h4></div><p class="text-gray-400">The technical expertise required to execute complex PFM methods limits their deployment in applied clinical settings.</p></div>
                        </div>
                    </div>
                </div>

                <div id="project" class="tab-content"></div>

                <div id="simulation" class="tab-content"></div>
            </div>
        </div>
    </div>

    <script>
        // --- Canvas Background ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function drawBackground() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0d1a2e');
            gradient.addColorStop(1, '#11223A');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = 'rgba(59, 130, 246, 0.05)';
            ctx.lineWidth = 1;
            const gridSize = 50;
            for (let x = 0; x < canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y < canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        window.addEventListener('resize', () => {
            resizeCanvas();
            drawBackground();
        });
        resizeCanvas();
        drawBackground();

        // --- Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.classList.add('text-gray-400', 'hover:text-gray-200', 'hover:border-gray-500');
                });
                button.classList.add('active');
                button.classList.remove('text-gray-400', 'hover:text-gray-200', 'hover:border-gray-500');
                const tabId = button.dataset.tab;
                tabContents.forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });
            });
        });

        // --- Interactive Work Package Logic ---
        function initializeWPCards() {
            const wpCards = document.querySelectorAll('.wp-card');
            wpCards.forEach(card => {
                card.addEventListener('click', () => {
                    const wpId = card.dataset.wp;
                    const details = document.getElementById(`${wpId}-details`);
                    const allDetails = document.querySelectorAll('.wp-details');
                    const isOpening = !details.classList.contains('open');

                    allDetails.forEach(d => { d.classList.remove('open'); });
                    if (isOpening) { details.classList.add('open'); }
                });
            });
        }
        
        // --- Populate WPs and Simulation ---
        function populateOtherTabs() {
            const projectTab = document.getElementById('project');
            const colors = {
                wp1: { bg: 'bg-blue-500/10', text: 'text-blue-200', border: 'border-blue-500', iconBg: 'bg-blue-500/80', hoverBorder: 'hover:border-blue-400' },
                wp2: { bg: 'bg-indigo-500/10', text: 'text-indigo-200', border: 'border-indigo-500', iconBg: 'bg-indigo-500/80', hoverBorder: 'hover:border-indigo-400' },
                wp3: { bg: 'bg-emerald-500/10', text: 'text-emerald-200', border: 'border-emerald-500', iconBg: 'bg-emerald-500/80', hoverBorder: 'hover:border-emerald-400' },
                wp4: { bg: 'bg-sky-500/10', text: 'text-sky-200', border: 'border-sky-500', iconBg: 'bg-sky-500/80', hoverBorder: 'hover:border-sky-400' }
            };

            projectTab.innerHTML = `
                    <h2 class="text-3xl font-bold text-white mb-6 text-center">Work Programme (72 Months)</h2>
                    <div class="max-w-5xl mx-auto">
                        <p class="text-center text-gray-400 mb-8">The project follows a two-phase work plan spanning establishing methodological baselines to deploying clinical software ecosystems.</p>
                        <div class="space-y-4" id="wp-container">
                            <div class="wp-card-container"><div class="wp-card cursor-pointer ${colors.wp1.bg} p-4 rounded-lg flex items-center space-x-4 border-2 border-transparent ${colors.wp1.hoverBorder}" data-wp="wp1"><div class="${colors.wp1.iconBg} p-3 rounded-full text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M5 11h14"/></svg></div><div><h4 class="font-bold ${colors.wp1.text}">Phase 1 | WP 1: The Knowledge Space</h4><p class="text-sm text-gray-400">Develop a dynamic registry to catalogue diverse PFM methods and quantify the stability gap.</p></div></div><div class="wp-details ${colors.wp1.bg} ${colors.wp1.border}" id="wp1-details"><p class="text-gray-300">Systematically evaluate existing knowledge and benchmark parcellation performance across varying scan durations to establish empirical evidence for subsequent methodological development.</p></div></div>
                            <div class="wp-card-container"><div class="wp-card cursor-pointer ${colors.wp2.bg} p-4 rounded-lg flex items-center space-x-4 border-2 border-transparent ${colors.wp2.hoverBorder}" data-wp="wp2"><div class="${colors.wp2.iconBg} p-3 rounded-full text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"/></svg></div><div><h4 class="font-bold ${colors.wp2.text}">Phase 1 | WP 2: Addressing Data Sparsity</h4><p class="text-sm text-gray-400">Develop generative diffusion frameworks to augment short clinical MRI scans.</p></div></div><div class="wp-details ${colors.wp2.bg} ${colors.wp2.border}" id="wp2-details"><p class="text-gray-300">Systematically evaluate conditioning priors (anatomical scaffolds, multimodality parameters) to recover individual network topology from sparse inputs.</p></div></div>
                            <div class="wp-card-container"><div class="wp-card cursor-pointer ${colors.wp3.bg} p-4 rounded-lg flex items-center space-x-4 border-2 border-transparent ${colors.wp3.hoverBorder}" data-wp="wp3"><div class="${colors.wp3.iconBg} p-3 rounded-full text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/></svg></div><div><h4 class="font-bold ${colors.wp3.text}">Phase 2 | WP 3: Solving Correspondence</h4><p class="text-sm text-gray-400">Design an advanced framework optimizing structural-functional alignment across individuals.</p></div></div><div class="wp-details ${colors.wp3.bg} ${colors.wp3.border}" id="wp3-details"><p class="text-gray-300">Utilize the Knowledge Space findings to resolve systematic inconsistencies in how parcellations align, maximizing predictive validity for individual phenotypes.</p></div></div>
                            <div class="wp-card-container"><div class="wp-card cursor-pointer ${colors.wp4.bg} p-4 rounded-lg flex items-center space-x-4 border-2 border-transparent ${colors.wp4.hoverBorder}" data-wp="wp4"><div class="${colors.wp4.iconBg} p-3 rounded-full text-white"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l-4 4-4-4M6 16l-4-4 4-4"/></svg></div><div><h4 class="font-bold ${colors.wp4.text}">Phase 2 | WP 4: The Individual Brain Toolbox</h4><p class="text-sm text-gray-400">Deploy a unified software environment integrating the developed generative and correspondence algorithms.</p></div></div><div class="wp-details ${colors.wp4.bg} ${colors.wp4.border}" id="wp4-details"><p class="text-gray-300">Operationalize methodological innovations via a standardized, user-friendly interface compatible with large-scale infrastructures, facilitating precision mapping in heterogeneous clinical cohorts.</p></div></div>
                        </div>
                        <h3 class="text-2xl font-semibold text-center mt-10 mb-4 text-white">Project Timeline & Deliverables</h3>
                        <div class="px-4 text-center">
                            <img src="IBP_Timeline.jpg" alt="Timeline of Phase 1 and Phase 2" class="mx-auto rounded-lg border border-gray-700 shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/1000x400/1e293b/94a3b8?text=[Figure+1:+Insert+Project+Timeline+Here]';">
                        </div>
                    </div>
            `;
            initializeWPCards();

            const simulationTab = document.getElementById('simulation');
            simulationTab.innerHTML = `
                <div class="text-center mb-6">
                    <button id="start-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:scale-105">Execute PFM Pipeline</button>
                </div>
                <div id="viz-area" class="relative w-full max-w-5xl mx-auto h-[450px] border border-gray-700 bg-black/20 rounded-lg p-4">
                    <svg id="connection-svg" class="absolute top-0 left-0 w-full h-full pointer-events-none z-10"></svg>
                    <div id="packet" class="packet"></div>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-bold text-center mb-4 text-white">System Execution Log</h3>
                    <div id="log" class="bg-gray-900 text-white font-mono text-sm rounded-lg p-4 h-48 overflow-y-auto space-y-2 border border-gray-700">
                        <p class="text-gray-400">> System idle. Awaiting data input...</p>
                    </div>
                </div>
            `;
            initializeSimulation();
        }

        function initializeSimulation() {
            const vizArea = document.getElementById('viz-area');
            vizArea.insertAdjacentHTML('afterbegin', `
                <div id="input" style="--glow-color: rgba(148, 163, 184, 0.7);" class="sim-element absolute top-1/2 -translate-y-1/2 left-4 w-28 h-28 bg-gray-800 border border-gray-600 rounded-full flex flex-col items-center justify-center text-center p-2"><svg class="h-8 w-8 text-gray-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7l8-4 8 4m-8 4v10"/></svg><span class="font-bold text-xs mt-1 text-gray-200">Sparse Data<br>(Clinical MRI)</span></div>
                
                <div class="absolute top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2 w-[400px] h-80 border-2 border-dashed border-blue-800 rounded-2xl flex items-center justify-center"><span class="absolute -top-3 bg-[#11223A] px-2 text-sm font-bold text-blue-400">Individual Brain Toolbox (WP4)</span>
                    <div id="ks" style="--glow-color: rgba(59, 130, 246, 0.7);" class="sim-element absolute top-4 w-32 h-20 bg-blue-900/50 border border-blue-700 rounded-lg flex flex-col items-center justify-center text-center p-1"><span class="font-bold text-xs text-blue-200">Knowledge Space<br>(WP1)</span></div>
                    <div id="gen" style="--glow-color: rgba(99, 102, 241, 0.7);" class="sim-element absolute bottom-6 left-6 w-36 h-24 bg-indigo-900/50 border border-indigo-700 rounded-lg flex flex-col items-center justify-center text-center p-1"><span class="font-bold text-xs text-indigo-200">Generative Diffusion<br>(WP2)</span></div>
                    <div id="cor" style="--glow-color: rgba(16, 185, 129, 0.7);" class="sim-element absolute bottom-6 right-6 w-36 h-24 bg-emerald-900/50 border border-emerald-700 rounded-lg flex flex-col items-center justify-center text-center p-1"><span class="font-bold text-xs text-emerald-200">Correspondence Opt.<br>(WP3)</span></div>
                </div>

                <div id="output" style="--glow-color: rgba(245, 158, 11, 0.7);" class="sim-element absolute top-1/2 -translate-y-1/2 right-4 w-28 h-28 bg-amber-900/40 border border-amber-600 rounded-full flex flex-col items-center justify-center text-center p-2"><svg class="h-8 w-8 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V3m0 18v-3M5.636 5.636l-1.414-1.414m15.152 0l-1.414 1.414M18.364 18.364l-1.414-1.414m-12.3-1.414l1.414 1.414M12 12a6 6 0 110-12 6 6 0 010 12z"/></svg><span class="font-bold text-xs mt-1 text-amber-200">Personalized<br>Atlas</span></div>
            `);

            const startBtn = document.getElementById('start-btn');
            const log = document.getElementById('log');
            const packet = document.getElementById('packet');
            const svgContainer = document.getElementById('connection-svg');
            
            const elements = {
                input: document.getElementById('input'),
                ks: document.getElementById('ks'),
                gen: document.getElementById('gen'),
                cor: document.getElementById('cor'),
                output: document.getElementById('output')
            };
            
            const workflow = [
                { agent: 'input', action: 'activate', message: 'Input: Short-duration clinical MRI scan received.' },
                { from: 'input', to: 'gen', message: 'Routing sparse data to Individual Brain Toolbox...' },
                { agent: 'gen', action: 'activate', message: 'Generative Model: Assessing topological stability gap.' },
                { from: 'gen', to: 'ks', message: 'Querying Knowledge Space for biological priors...' },
                { agent: 'ks', action: 'activate', message: 'Knowledge Space: Extracting benchmarked structural scaffolds.' },
                { from: 'ks', to: 'gen', message: 'Providing physiological constraints to Generative Model.' },
                { agent: 'gen', action: 'think', message: 'Generative Model: Synthesizing augmented topology from sparse input.' },
                { from: 'gen', to: 'cor', message: 'Passing augmented data to Correspondence Framework.' },
                { agent: 'cor', action: 'activate', message: 'Correspondence Alg: Aligning functional and structural boundaries.' },
                { agent: 'cor', action: 'think', message: 'Correspondence Alg: Resolving systematic spatial inconsistencies.' },
                { from: 'cor', to: 'output', message: 'Exporting final precision mapping.' },
                { agent: 'output', action: 'activate', message: 'Output generated: High-fidelity individualized brain parcellation.' },
                { agent: 'output', action: 'think', message: 'Atlas ready for downstream predictive validity modeling.' }
            ];

            const sleep = (ms) => new Promise(res => setTimeout(res, ms));

            function addLogEntry(message) {
                const entry = document.createElement('p');
                entry.innerHTML = `<span class="text-blue-400 mr-2">></span> ${message}`;
                entry.className = 'log-entry';
                log.appendChild(entry);
                log.scrollTop = log.scrollHeight;
            }

            function getElementCenter(el) {
                if (!el) return { x: 0, y: 0 };
                const rect = el.getBoundingClientRect();
                const containerRect = document.getElementById('viz-area').getBoundingClientRect();
                return {
                    x: rect.left - containerRect.left + rect.width / 2,
                    y: rect.top - containerRect.top + rect.height / 2,
                };
            }
            
            let currentLine = null;
            function drawConnection(fromEl, toEl) {
                if (currentLine) { currentLine.remove(); }
                const start = getElementCenter(fromEl);
                const end = getElementCenter(toEl);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', start.x);
                line.setAttribute('y1', start.y);
                line.setAttribute('x2', end.x);
                line.setAttribute('y2', end.y);
                line.setAttribute('class', 'connection-line');
                svgContainer.appendChild(line);
                setTimeout(() => { line.style.opacity = '0.7'; }, 50);
                currentLine = line;
            }

            async function movePacket(fromEl, toEl) {
                drawConnection(fromEl, toEl);
                const start = getElementCenter(fromEl);
                const end = getElementCenter(toEl);
                packet.style.left = `${start.x - 6}px`;
                packet.style.top = `${start.y - 6}px`;
                packet.style.opacity = '1';
                await sleep(50);
                packet.style.left = `${end.x - 6}px`;
                packet.style.top = `${end.y - 6}px`;
                await sleep(1000);
                packet.style.opacity = '0';
                if(currentLine) currentLine.style.opacity = '0';
                await sleep(300);
            }

            function setActive(elementKeys) {
                const keys = Array.isArray(elementKeys) ? elementKeys : [elementKeys];
                const allElements = document.querySelectorAll('.sim-element');
                allElements.forEach(el => el.classList.remove('active'));
                keys.forEach(key => {
                    if (key && elements[key]) { elements[key].classList.add('active'); }
                });
            }

            async function runSimulation() {
                startBtn.disabled = true;
                startBtn.classList.add('opacity-50', 'cursor-not-allowed');
                log.innerHTML = '';

                for (const step of workflow) {
                    setActive(step.agent);
                    addLogEntry(step.message);
                    if (step.from && step.to) {
                        await movePacket(elements[step.from], elements[step.to]);
                    } else {
                        await sleep(2000);
                    }
                }

                setActive(null);
                addLogEntry('Pipeline execution complete. Precision framework applied.');
                startBtn.disabled = false;
                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            if(startBtn) {
                startBtn.addEventListener('click', runSimulation);
            }
        }
        
        populateOtherTabs();
    </script>
</body>
</html>